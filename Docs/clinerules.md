# Инструкция по Требованиям Проекта BrainMessenger

## 1. Введение

**Цель проекта:** Разработать и запустить мессенджер BrainMessenger с уникальными функциями и высоким уровнем пользовательского опыта.

Этот документ содержит пошаговое описание всех требований проекта, разделенное на категории, а также анализ текущего состояния реализации.

**Обозначения:**
*   ✅ - Задача выполнена
*   [ ] - Задача не выполнена / В процессе

## 2. Требования Проекта по Категориям

### Приоритет 1: Аудио и Видео Звонки
*   ✅ Реализовать аудио или видео звонки с другим пользователем (FR-16)
    *   ✅ Реализовать сигнализацию WebRTC
    *   ✅ Реализовать обмен ICE кандидатами
    *   ✅ Реализовать аудио и видео потоки
    *   ✅ Реализовать управление состоянием звонка
    *   ✅ Реализовать включение/выключение звука
    *   ✅ Реализовать включение/выключение видео
    *   ✅ Реализовать завершение звонка
    *   ✅ Реализовать обработку входящих звонков
*   ✅ Реализовать конференц-звонки с несколькими участниками (FR-17)
*   ✅ Реализовать список истории звонков (FR-18)
*   ✅ Реализовать настройки качества видео и аудио (FR-19)

### Приоритет 2: Конфиденциальность и Безопасность
*   ✅ Реализовать настройки конфиденциальности (FR-9)
    *   ✅ Реализовать настройки управления видимостью информации профиля
*   ✅ Реализовать расширенные функции безопасности и опции шифрования
    *   ✅ Реализовать шифрование данных при передаче (TLS/SSL) и в состоянии покоя (AES) (NFR-5)
    *   ✅ Реализовать хеширование паролей с помощью bcrypt (NFR-6)
    *   ✅ Реализовать защиту от SQL-инъекций, XSS и DDoS атак (NFR-7)
    *   ✅ Реализовать подтверждение кодом с 10-минутным сроком действия и лимитом в 5 попыток (NFR-8)

### Приоритет 3: Каналы и Управление Файлами
*   [ ] Реализовать каналы (FR-14)
    *   [ ] Реализовать подписку на публичные каналы
    *   [ ] Реализовать чтение контента из публичных каналов
*   [ ] Реализовать отправку и получение файлов (FR-20)
    *   ✅ Реализовать функциональность загрузки файлов
    *   [ ] Реализовать функциональность скачивания файлов

### Приоритет 4: Премиум Подписка
*   [ ] Реализовать премиум подписку (FR-30, FR-31, FR-32)
    *   [ ] Реализовать отображение преимуществ премиум подписки (FR-30)
    *   [ ] Реализовать подписку на премиум через платежную систему (FR-31)
        *   [ ] Реализовать интеграцию со Stripe
        *   [ ] Реализовать интеграцию с Cryptomus
    *   [ ] Реализовать просмотр истории платежей (FR-32)

### Приоритет 5: Многоязычная Поддержка
*   [ ] Добавить поддержку арабского языка и RTL (Right-to-Left)

### Приоритет 6: Реализация UI Дизайна
*   ✅ Реализовать цветовую палитру для Светлого и Темного режимов (DD-1)
    *   ✅ Установить основной градиент, акцентные цвета, вторичные цвета и т.д.
*   ✅ Реализовать типографику с использованием шрифта Roboto (DD-2)
    *   ✅ Установить размеры и стили шрифтов для заголовков, основного текста, подписей и кнопок
*   [ ] Реализовать анимации для элементов UI (DD-3)
    *   [ ] Реализовать переходы слайдов, нажатия кнопок, отправку сообщений и т.д.
*   ✅ Реализовать систему макетов и сеток (DD-4)
    *   [ ] Использовать 8px сеточную систему для отступов и определить адаптивные точки останова (responsive breakpoints)
*   [ ] Реализовать гайдлайны доступности (Accessibility) (DD-5)
    *   [ ] Убедиться, что UI соответствует гайдлайнам WCAG 2.1 AA
    *   [ ] Реализовать достаточный контраст, навигацию с клавиатуры, ARIA атрибуты и поддержку RTL

### Приоритет 7: Реализация Тестирования
*   [ ] Реализовать модульные тесты (unit tests) для отдельных функций и компонентов (TE-1)
    *   ✅ Использовать Jest для модульного тестирования
*   [ ] Реализовать интеграционные тесты для взаимодействий API и сервисов (TE-2)
    *   [ ] Использовать Cypress и Postman для интеграционного тестирования
*   [ ] Реализовать системные тесты для UI и функциональности (TE-3)
    *   [ ] Использовать Playwright для системного тестирования
*   [ ] Реализовать нагрузочные тесты для оценки производительности под высокой нагрузкой (TE-4)
    *   [ ] Использовать JMeter или k6 для нагрузочного тестирования
*   [ ] Реализовать тесты безопасности для проверки уязвимостей (TE-5)
    *   [ ] Использовать OWASP ZAP или Burp Suite для тестирования безопасности
*   [ ] Реализовать регрессионные тесты для повторной проверки ключевых функций после исправлений (TE-6)
    *   [ ] Использовать Cypress и Playwright для регрессионного тестирования
*   [ ] Создать детальные тестовые сценарии для каждой функции (TE-7)
    *   [ ] Включить регистрацию, аутентификацию, управление профилем, чаты, звонки, файлы, настройки и премиум подписку

### Приоритет 8: Реализация Поддержки и Обслуживания
*   [ ] Настроить каналы поддержки (SU-1)
    *   ✅ Настроить канал поддержки по email
    *   [ ] Настроить форму поддержки в приложении
    *   [ ] Настроить внутренний Slack канал
*   [ ] Определить роли и обязанности (SU-2)
    *   [ ] Определить роли для специалистов поддержки, DevOps, разработчиков и технических лидеров
*   [ ] Реализовать процесс эскалации (SU-3)
    *   [ ] Реализовать процесс эскалации для различных типов проблем
*   [ ] Реализовать процесс обработки запросов (SU-4)
    *   [ ] Реализовать процесс получения, регистрации, анализа, решения и закрытия запросов пользователей
*   [ ] Реализовать мониторинг (SU-5)
    *   [ ] Реализовать мониторинг с использованием Prometheus, Grafana и Sentry
*   [ ] Реализовать резервное копирование и восстановление (SU-6)
    *   [ ] Реализовать процедуры резервного копирования и восстановления для Neon (PostgreSQL) и Cloudflare R2
*   [ ] Реализовать управление обновлениями (SU-7)
    *   [ ] Реализовать процедуры управления обновлениями для патчей, минорных и мажорных релизов
*   [ ] Реализовать реагирование на инциденты (SU-8)
    *   [ ] Реализовать процедуры реагирования на инциденты для сбоев серверов, утечек данных и высокой нагрузки

## 3. Анализ Текущей Реализации

### 3.1. Что Уже Выполнено (✅)
*   **Базовая функциональность и UI:**
    *   Реализован экран регистрации с валидацией.
    *   Созданы файлы экранов согласно UI документации.
    *   Реализована базовая навигация.
    *   Реализован слайдер на Welcome Screen.
    *   Реализован список чатов с поиском.
    *   Реализован список контактов с поиском.
    *   Реализована форма редактирования профиля и настроек конфиденциальности.
    *   Реализованы настройки уведомлений, тем и безопасности.
    *   Реализовано описание преимуществ подписки, управление и история платежей (базово).
    *   Реализованы функции просмотра файлов, фильтрации и управления хранилищем.
    *   Реализован доступ к архивированным чатам.
    *   Реализован выбор языка с мгновенным обновлением интерфейса (кроме Арабского).
    *   Реализованы настройки анимаций и эффектов.
    *   Реализованы настройки тем чатов и шрифтов.
*   **Компоненты:**
    *   Созданы и интегрированы компоненты `LanguageSelector`, `AnimationSettings`, `ChatThemeSettings`.
*   **Локализация:**
    *   Добавлена поддержка испанского языка (es).
    *   Обновлена конфигурация i18n.
*   **Кастомизация:**
    *   Расширены опции тем, шрифтов, стилей сообщений и фонов в `ChatThemeSettings`.
*   **Безопасность:**
    *   Реализованы расширенные функции безопасности в `SecuritySettings`.
    *   Исправлены проблемы в `SecuritySettings`.
    *   Реализованы все основные требования безопасности (шифрование, хеширование, защита от атак, подтверждение кодом).
*   **Звонки:**
    *   Полностью реализована функциональность аудио/видео звонков 1-на-1 (FR-16).
    *   Реализованы конференц-звонки (FR-17).
    *   Реализована история звонков (FR-18).
    *   Реализованы настройки качества звонков (FR-19).
*   **Управление файлами:**
    *   Реализована загрузка файлов.
*   **Дизайн:**
    *   Реализованы цветовая палитра (DD-1), типографика (DD-2), система макетов (DD-4).
*   **Тестирование:**
    *   Настроен Jest для unit-тестов.
*   **Поддержка:**
    *   Настроен email канал поддержки.
*   **Зависимости:**
    *   Установлены все необходимые зависимости проекта.

### 3.2. Что Требует Доработки ([ ])
*   **Каналы:** Полная реализация функциональности каналов (подписка, чтение).
*   **Управление файлами:** Реализация скачивания файлов.
*   **Премиум Подписка:** Полная реализация, включая интеграцию с платежными системами (Stripe, Cryptomus) и отображение истории платежей.
*   **Многоязычная Поддержка:** Добавление поддержки арабского языка и RTL.
*   **UI Дизайн:** Реализация анимаций (DD-3) и гайдлайнов доступности (DD-5), включая RTL.
*   **Тестирование:** Реализация интеграционных, системных, нагрузочных, тестов безопасности и регрессионных тестов. Создание детальных тест-сценариев.
*   **Поддержка и Обслуживание:** Настройка формы поддержки в приложении и Slack-канала, определение ролей, реализация процессов эскалации и обработки запросов, мониторинга, бэкапов, управления обновлениями и реагирования на инциденты.

### 3.3. Возникшие Трудности (Потенциальные)
*   **Реализация WebRTC:** Хотя задачи по звонкам отмечены как выполненные, внедрение WebRTC (сигнализация, ICE, управление состоянием) является сложной задачей и могла потребовать значительных усилий и отладки. Поддержка стабильных конференц-звонков также может представлять сложность.
*   **Интеграция с Платежными Системами:** Настройка Stripe и Cryptomus требует внимательной работы с API, обработки веб-хуков и обеспечения безопасности транзакций.
*   **Поддержка RTL:** Корректная реализация поддержки языков с письмом справа налево (арабский) затрагивает весь UI и требует тщательного тестирования.
*   **Комплексное Тестирование:** Обеспечение полного покрытия тестами (unit, integration, system, load, security, regression) требует времени и ресурсов.

### 3.4. Рекомендации и Качественные Практики
*   **Следование Технологическому Стеку:** Продолжать использовать выбранные технологии (TypeScript, React/Next.js, NestJS, PostgreSQL/TypeORM, GraphQL, WebSockets, Redis, Kafka и т.д.) для консистентности.
*   **Модульное Тестирование:** Уделять внимание написанию unit-тестов (Jest) для новых компонентов и функций для раннего обнаружения ошибок.
*   **Интеграционное и Системное Тестирование:** Планомерно внедрять интеграционные (Cypress, Postman) и системные (Playwright) тесты для проверки взаимодействия компонентов и сквозных сценариев.
*   **Code Review:** Регулярно проводить ревью кода для обмена знаниями, улучшения качества кода и соответствия стандартам.
*   **CI/CD:** Настроить или оптимизировать процессы непрерывной интеграции и доставки (например, с использованием Vercel) для автоматизации сборки, тестирования и развертывания.
*   **Мониторинг и Логирование:** Активно использовать настроенные инструменты мониторинга (Prometheus, Grafana, Sentry) для отслеживания производительности и ошибок в реальном времени.
*   **Безопасность:** Продолжать следовать лучшим практикам безопасности на всех уровнях (код, инфраструктура, зависимости). Регулярно обновлять зависимости.
*   **Документация:** Поддерживать актуальность технической документации и комментариев в коде.

## 4. Технологический Стек Проекта

*   **Язык:** TypeScript (Frontend & Backend)
*   **Frontend:** React, Next.js
*   **Backend:** NestJS
*   **База Данных:** PostgreSQL (Neon)
*   **ORM:** TypeORM
*   **API:** GraphQL
*   **Real-time:** WebSockets
*   **Кэширование:** Redis
*   **Очереди:** Kafka
*   **Хранилище Файлов:** Cloudflare R2
*   **Уведомления:** Firebase
*   **Платежи:** Stripe, Cryptomus
*   **Email/2FA:** Gmail API
*   **Тестирование:** Jest, Cypress, k6, Playwright, (OWASP ZAP/Burp Suite - планируется)
*   **Развертывание:** Vercel
*   **Мониторинг:** Prometheus, Grafana, Sentry (планируется)
