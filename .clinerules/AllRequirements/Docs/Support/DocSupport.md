# Руководство по поддержке и обслуживанию BrainMessenger

### 1. Введение

**Название проекта:** BrainMessenger

**Описание:** Руководство описывает процедуры поддержки пользователей, устранения проблем, мониторинга системы и выпуска обновлений для BrainMessenger.

**Цель:** Обеспечить uptime 99.9% (NFR-12), оперативно реагировать на запросы пользователей и поддерживать долгосрочную стабильность приложения после релиза (v1.0, март 2025).

**Аудитория:** Команда поддержки, DevOps, разработчики.

---

### 2. Цели поддержки и обслуживания

- **Поддержка:** Решение проблем пользователей в течение 24 часов (NFR-13).
- **Обслуживание:** Минимизация сбоев, обновление системы без простоев.
- **Обратная связь:** Сбор и анализ отзывов для улучшения продукта.

---

### 3. Организация поддержки

#### 3.1. Каналы связи

- **Email:** [support@brainmessenger.com](mailto:support@brainmessenger.com)
  - Время ответа: ≤24 часа (NFR-13).
- **В приложении:** Настройки → "Help" → "Contact Us"
  - Форма с полями: тема, описание, прикрепление файлов (скриншоты, логи).
- **Slack:** Внутренний канал #support для команды.

#### 3.2. Роли и обязанности

| Роль              | Обязанности                     | Контакт          |
|-------------------|---------------------------------|------------------|
| Специалист поддержки | Ответы пользователям, эскалация проблем | support-team@... |
| DevOps            | Мониторинг, устранение сбоев    | devops@...       |
| Разработчик       | Исправление багов, обновления   | dev-team@...     |
| Техлид            | Координация сложных инцидентов  | techlead@...     |

#### 3.3. Эскалация проблем

- **Уровень 1:** Специалист поддержки → Решает базовые вопросы (пароль, UI).
- **Уровень 2:** DevOps → Сетевые сбои, серверные ошибки (500, 503).
- **Уровень 3:** Разработчик/Техлид → Баги в коде, интеграциях.

---

### 4. Процесс обработки запросов пользователей

1. **Получение запроса:**
   - Через email или форму в приложении.
2. **Регистрация:**
   - Запись в системе тикетов (например, Jira Service Desk):
     - Номер тикета: `SUP-123`.
     - Описание: "Не отправляется сообщение".
     - Приоритет: Низкий/Средний/Высокий.
3. **Анализ:**
   - Проверка логов в Kibana (см. Руководство по мониторингу).
   - Воспроизведение проблемы в staging-среде.
4. **Решение:**
   - Ответ пользователю с инструкцией (например, "Очистите кэш").
   - Эскалация, если требуется (см. 3.3).
5. **Закрытие:**
   - Подтверждение решения от пользователя → Закрытие тикета.

#### 4.1. Приоритеты

- **Высокий:** Критические сбои (500 ошибок, недоступность).
- **Средний:** Функциональные баги (не работает поиск).
- **Низкий:** Косметические проблемы (UI-ошибки).

---

### 5. Обслуживание системы

#### 5.1. Мониторинг

- **Инструменты:** Prometheus, Grafana, Sentry (см. Руководство по мониторингу).
- **Метрики:**
  - Uptime (≥99.9%).
  - Время ответа API (<500 мс).
  - Ошибки (>1% → оповещение).
- **Оповещения:**
  - Slack: CPU >80%, ошибки 500 >5%.
  - Email: Uptime <99.9%.

#### 5.2. Резервное копирование

- **Данные:**
  - PostgreSQL (Neon): Ежедневный бэкап через встроенные инструменты Neon с шифрованием AES-256.
  - Хранение: 30 дней.
- **Файлы:**
  - Cloudflare R2: Lifecycle policy — удаление после 90 дней.
- **Восстановление:**
  - Тестируется ежемесячно в staging-среде.

#### 5.3. Управление обновлениями

- **Типы обновлений:**
  - **Патчи:** Исправление багов (например, v1.0.1).
  - **Минорные:** Новые функции (v1.1.0).
  - **Мажорные:** Архитектурные изменения (v2.0.0).
- **График:**
  - Патчи: По необходимости (≤24 часа для критических багов).
  - Минорные: Ежеквартально (Q2, Q3 и т.д., см. Дорожную карту).
  - Мажорные: Ежегодно (Q1 2026 — микросервисы).
- **Процесс:**
  1. Тестирование в staging.
  2. Деплой через Kubernetes с rolling updates:
     ```bash
     kubectl set image deployment/backend backend=brainmessenger-backend:v1.0.1
     ```
  3. Проверка health-эндпоинта:
     ```bash
     curl https://api.brainmessenger.com/health
     ```

#### 5.4. Миграция данных

- **Сценарий:** Изменение схемы PostgreSQL (например, добавление поля).
- **Процесс:**
  1. Создание миграции:
     ```bash
     cd backend
     npx prisma migrate dev --name add-column
     ```
  2. Тестирование в staging.
  3. Применение в продакшен с минимальным downtime:
     ```bash
     npx prisma migrate deploy
     ```

---

### 6. Реагирование на инциденты

- **Типичные инциденты:**
  - Сервер недоступен (503).
  - Утечка данных (см. Руководство по безопасности).
  - Высокая нагрузка (>1000 пользователей).
- **Шаги:**
  1. Обнаружение через Grafana/Sentry.
  2. Оценка в Slack (#incident).
  3. Реакция:
     - 503: Перезапуск подов (`kubectl rollout restart`).
     - Нагрузка: Увеличение подов в Kubernetes.
  4. Уведомление пользователей (email при утечке, ≤72 часа по GDPR).
  5. Анализ и отчёт в Jira.

---

### 7. Рекомендации

#### 7.1. Команде поддержки

- Используйте шаблоны ответов:
  - "Проверьте интернет и повторите".
  - "Спасибо за сообщение, мы работаем над этим (SUP-123)".
- Проверяйте FAQ перед эскалацией (см. Руководство пользователя).

#### 7.2. DevOps

- Поддерживайте минимум 2 пода в Kubernetes для отказоустойчивости.
- Тестируйте бэкапы ежемесячно.

#### 7.3. Разработчикам

- Исправляйте критические баги в течение 24 часов.
- Документируйте изменения в `CHANGELOG.md`.

---

### 8. Примеры

- **Запрос:** "Не могу войти".
  - Ответ: "Проверьте email/пароль. Если проблема сохраняется, сбросьте пароль через 'Forgot Password?' (SUP-124)".
- **Обновление:**
  - Патч v1.0.1: "Исправлен баг с отправкой файлов".
  - Деплой: `kubectl apply -f k8s/deployment.yaml`.

---

### 9. Примечания

- **План:** Полная поддержка начинается с релиза v1.0 (Q1 2025).
- **Масштабирование:** При росте пользователей (>100k) добавить сотрудников в поддержку.
- **Обратная связь:** Анализировать запросы для Дорожной карты (например, частые баги → приоритет).

---

### Итог изменений
- **Nhost** заменён на **Neon** в разделе 5.2 (Резервное копирование).
- **AWS S3** заменён на **Cloudflare R2** в разделе 5.2 (Резервное копирование).
- Удалены упоминания других сервисов AWS (например, Glacier заменён на удаление после 90 дней в Cloudflare R2).
- Обновлены команды миграции в разделе 5.4, заменив `npm run migrate` на команды Prisma (`npx prisma migrate dev` и `npx prisma migrate deploy`).
- Сохранена вся структура документации, включая заголовки, подзаголовки и форматирование.