# Руководство по локализации BrainMessenger

### 1. Введение

**Название проекта:** BrainMessenger

**Описание:** Руководство описывает процесс локализации BrainMessenger для поддержки нескольких языков, включая настройку переводов, адаптацию UI и тестирование.

**Цель:** Обеспечить доступность приложения для пользователей по всему миру, начиная с минимум 5 языков (английский, испанский, французский, русский, арабский), с возможностью масштабирования.

**Текущий статус:** Базовая поддержка английского языка (v1.0, март 2025).

---

### 2. Цели локализации

- Поддержка минимум 5 языков (NFR-11).
- Адаптация UI для языков с направлением справа налево (RTL, например, арабский).
- Обеспечение единообразия терминологии и стиля перевода.
- Упрощение добавления новых языков в будущем.

---

### 3. Инструменты и технологии

| Инструмент | Назначение | Установка/Конфигурация |
| --- | --- | --- |
| `i18next` | Управление переводами | `npm install i18next react-i18next` |
| `react-intl` | Форматирование (даты, числа) | `npm install react-intl` |
| `Transifex` | Платформа для переводчиков | Регистрация на [transifex.com](http://transifex.com/) |
| `rtlcss` | Адаптация стилей для RTL | `npm install rtlcss` |

---

### 4. Структура файлов переводов

### 4.1. Расположение

Переводы хранятся в JSON-файлах в директории frontend:

```
frontend/
├── src/
│   ├── locales/
│   │   ├── en.json       # Английский
│   │   ├── es.json       # Испанский
│   │   ├── fr.json       # Французский
│   │   ├── ru.json       # Русский
│   │   ├── ar.json       # Украинский
│   │   ├── ar.json       # Арабский
│   └── index.ts          # Конфигурация i18next

```

### 4.2. Формат JSON

- Ключи: Именуются в camelCase, отражают контекст.
- Значения: Переводимый текст с поддержкой интерполяции.
- Пример `en.json`:

```json
{
  "welcome": "Welcome to BrainMessenger!",
  "sendButton": "Send",
  "error": {
    "unauthorized": "Please log in again",
    "notFound": "Item not found"
  },
  "chat": {
    "newMessage": "New message from {{name}}"
  }
}

```

### 4.3. RTL-флаг

Для языков с RTL добавляется метаданные:

```json
{
  "rtl": true,
  "welcome": "مرحبًا بك في BrainMessenger!"
}

```

---

### 5. Настройка локализации

### 5.1. Frontend (React Native)

1. **Инициализация i18next:**
В `frontend/src/index.ts`:
    
    ```jsx
    import i18n from 'i18next'
    import { initReactI18next } from 'react-i18next'
    import en from './locales/en.json'
    import ar from './locales/ar.json'
    
    i18n
      .use(initReactI18next)
      .init({
        resources: {
          en: { translation: en },
          ar: { translation: ar },
        },
        lng: 'en', // Язык по умолчанию
        fallbackLng: 'en', // Резервный язык
        interpolation: { escapeValue: false },
      })
    
    export default i18n
    
    ```
    
2. **Использование в компонентах:**
    
    ```jsx
    import { useTranslation } from 'react-i18next'
    
    const ChatScreen = () => {
      const { t, i18n } = useTranslation()
      return (
        <View>
          <Text>{t('welcome')}</Text>
          <Button title={t('sendButton')} onPress={sendMessage} />
        </View>
      )
    }
    
    ```
    
3. **Смена языка:**
    
    ```jsx
    i18n.changeLanguage('ar') // Переключение на арабский
    
    ```
    

### 5.2. Backend (NestJS)

- Перевод ошибок возвращается в API (см. Спецификацию ошибок):
    
    ```tsx
    throw new HttpException(t('error.unauthorized'), 401)
    
    ```
    
- Локаль пользователя определяется из заголовка `Accept-Language` или настроек профиля.

### 5.3. RTL-адаптация

- **Стили:** Используйте `rtlcss` для автоматической адаптации:
    
    ```css
    /* Исходный CSS */
    .chat { margin-left: 10px; }
    /* После rtlcss для ar */
    .chat { margin-right: 10px; }
    
    ```
    
- **React Native:**
    
    ```jsx
    import { I18nManager } from 'react-native'
    const isRTL = i18n.language === 'ar'
    I18nManager.forceRTL(isRTL)
    
    ```
    

---

### 6. Процесс добавления нового языка

1. **Создание файла:**
    - Скопируйте `en.json` в `frontend/src/locales/<code>.json` (например, `de.json` для немецкого).
2. **Перевод:**
    - Загрузите файл в Transifex → Назначьте переводчиков → Экспортируйте готовый JSON.
3. **Интеграция:**
    - Добавьте язык в `i18n.resources`:
        
        ```jsx
        resources: { de: { translation: require('./locales/de.json') } }
        
        ```
        
4. **Тестирование:**
    - Переключите язык в настройках → Проверьте UI и RTL (если применимо).

---

### 7. Поддерживаемые языки (начальный список)

| Код | Язык | Направление | Статус |
| --- | --- | --- | --- |
| en | Английский | LTR | Реализован |
| es | Испанский | LTR | В плане (Q3 2025) |
| fr | Французский | LTR | В плане (Q3 2025) |
| ru | Русский | LTR | В плане (Q3 2025) |
| ar | Арабский | RTL | В плане (Q3 2025) |

---

### 8. Рекомендации по локализации

### 8.1. Разработчикам

- Избегайте хардкода строк в коде — используйте `t('key')`.
- Поддерживайте интерполяцию для динамических данных:
    
    ```jsx
    t('chat.newMessage', { name: 'John' }) // "New message from John"
    
    ```
    
- Тестируйте длинные переводы (например, немецкий) для проверки UI-разметки.

### 8.2. Дизайнерам

- Учитывайте расширение текста (до 30% длиннее для некоторых языков).
- Проверяйте зеркальное отображение UI для RTL (иконки, стрелки).

### 8.3. Переводчикам

- Сохраняйте контекст: "Send" в кнопке ≠ "Send" в письме.
- Используйте формальный стиль для ошибок и уведомлений.

---

### 9. Форматирование (даты, числа)

- Используйте `react-intl` для локализованного формата:
    
    ```jsx
    import { FormattedDate } from 'react-intl'
    <FormattedDate value={new Date()} /> // "03/14/2025" (en) или "14.03.2025" (ru)
    
    ```
    
- Числа:
    
    ```jsx
    import { FormattedNumber } from 'react-intl'
    <FormattedNumber value={1234.56} /> // "1,234.56" (en) или "1 234,56" (fr)
    
    ```
    

---

### 10. Тестирование локализации

- **Сценарии:**
    - Переключение языка в настройках.
    - Отображение длинных строк (например, немецкий).
    - RTL-UI (арабский): зеркальность, выравнивание.
- **Инструменты:**
    - Ручное тестирование с `i18n.changeLanguage`.
    - Cypress: Проверка ключей перевода (см. Руководство по тестированию).
- **Критерии успеха:**
    - 100% строк переведены.
    - Нет обрезки текста в UI.
    - Корректное RTL-отображение.

---

### 11. Примечания

- **План:** Полная локализация на 5 языков запланирована на Q3 2025 (см. Дорожную карту).
- **Масштабирование:** Поддержка новых языков добавляется по запросу пользователей (>10% запросов).
- **Ограничения:** Не переводятся логи и технические детали ошибок (только UI).